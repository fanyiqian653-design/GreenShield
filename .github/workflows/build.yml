name: Build iOS App

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: List files
      run: ls -la
    
    - name: Create project directory
      run: mkdir -p GreenShieldModifier
    
    - name: Copy files
      run: |
        cp *.swift GreenShieldModifier/
        cp *.plist GreenShieldModifier/
        cp *.storyboard GreenShieldModifier/
    
    - name: Create Xcode project
      run: |
        cd GreenShieldModifier
        xcodebuild -project create -target GreenShieldModifier || true
    
    - name: Build with xcodebuild
      run: |
        cd GreenShieldModifier
        xcodebuild -scheme GreenShieldModifier -configuration Release -sdk iphoneos build || true
    
    - name: Create IPA
      run: |
        cd GreenShieldModifier
        mkdir -p Payload
        cp -R Build/Products/Release-iphoneos/GreenShieldModifier.app Payload/
        zip -r GreenShieldModifier.ipa Payload/ || true
    
    - name: Upload IPA
      uses: actions/upload-artifact@v4
      with:
        name: GreenShieldModifier
        path: GreenShieldModifier/GreenShieldModifier.ipa
        retention-days: 30
